# 包边界和导入规则

## 包依赖关系定义

### 1. 包层级结构

```
awesome-tools/
├── packages/
│   ├── screenshot-splitter/      # 应用层 (L1)
│   ├── shared-components/        # 共享服务层 (L2)  
│   └── ui-library/               # 基础组件层 (L3)
```

### 2. 依赖方向规则

- **L3 → L2**: ✅ 允许 (ui-library → shared-components)
- **L3 → L1**: ❌ 禁止 (ui-library → screenshot-splitter)
- **L2 → L1**: ✅ 允许 (shared-components → screenshot-splitter)
- **L2 → L3**: ❌ 禁止 (shared-components → ui-library)
- **L1 → L2**: ✅ 允许 (screenshot-splitter → shared-components)
- **L1 → L3**: ✅ 允许 (screenshot-splitter → ui-library)

### 3. 包职责边界

#### screenshot-splitter (L1 - 应用层)
- 主要功能：长截图分割工具应用
- 职责：用户界面、业务逻辑、路由管理
- 允许导入：shared-components, ui-library
- 禁止导入：无外部包限制

#### shared-components (L2 - 共享服务层)
- 主要功能：共享组件和状态管理
- 职责：跨应用通用组件、状态管理、工具函数
- 允许导入：ui-library
- 禁止导入：screenshot-splitter

#### ui-library (L3 - 基础组件层)
- 主要功能：基础UI组件库
- 职责：原子组件、样式系统、设计规范
- 允许导入：无内部包依赖
- 禁止导入：screenshot-splitter, shared-components

## 导入规则配置

### ESLint 规则配置

在 `eslint.config.js` 中添加以下规则：

```javascript
// 包边界检查规则
{
  rules: {
    'no-restricted-imports': [
      'error',
      {
        patterns: [
          {
            group: ['**/shared-components/src/**'],
            message: '请使用包名导入: import { Component } from "shared-components"'
          },
          {
            group: ['**/ui-library/src/**'], 
            message: '请使用包名导入: import { Component } from "ui-library"'
          }
        ]
      }
    ]
  }
}
```

### TypeScript 路径映射

在 `tsconfig.json` 中添加路径映射：

```json
{
  "compilerOptions": {
    "paths": {
      "shared-components": ["./packages/shared-components/src"],
      "ui-library": ["./packages/ui-library/src"]
    }
  }
}
```

## 最佳实践

### 1. 导入方式

✅ **正确的方式**：
```typescript
import { CopyrightInfo } from 'shared-components';
import { Button } from 'ui-library';
```

❌ **错误的方式**：
```typescript
import { CopyrightInfo } from '../../shared-components/src/components/CopyrightInfo';
import { Button } from '../../../ui-library/src/components/Button';
```

### 2. 包版本管理

所有内部包依赖使用 workspace 协议：

```json
{
  "dependencies": {
    "shared-components": "workspace:*",
    "ui-library": "workspace:*"
  }
}
```

### 3. 循环依赖检查

定期运行循环依赖检查：
```bash
pnpm dlx madge --circular packages/screenshot-splitter/src
pnpm dlx madge --circular packages/shared-components/src  
pnpm dlx madge --circular packages/ui-library/src
```

## 执行检查

当前包依赖状态检查：

```bash
# 检查 screenshot-splitter 依赖
pnpm ls --depth=1 --filter screenshot-splitter

# 检查 shared-components 依赖  
pnpm ls --depth=1 --filter shared-components

# 检查 ui-library 依赖
pnpm ls --depth=1 --filter ui-library
```

## 常见问题处理

### 问题1: 类型导出缺失
**症状**: TypeScript 找不到类型定义
**解决**: 确保每个包的 `src/index.ts` 正确导出所有类型

### 问题2: 构建时依赖解析失败  
**症状**: 构建时报错找不到模块
**解决**: 检查 `tsconfig.json` 路径映射和包导出配置

### 问题3: 热更新不工作
**症状**: 代码修改后页面不自动刷新
**解决**: 确保使用 workspace 协议导入，避免相对路径
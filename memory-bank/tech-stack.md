
# 技术选型文档 (Tech Stack) - v2 (纯客户端方案)

## 1. 核心约束

本次技术选型严格遵循以下两个核心约束：

1.  **纯客户端实现 (Client-Side Only)**: 所有文件的处理，包括分割、转换和打包，都必须在用户的浏览器中完成。
2.  **静态站点托管 (Static Site Hosting)**: 项目最终将部署在 GitHub Pages 等静态托管服务上，不存在任何服务器端运行时环境 (如 Node.js)。

---

## 2. 现有技术栈回顾

*   **框架**: Astro.js (`^5.11.0`) - 用于构建静态页面和管理前端组件。
*   **UI**: Tailwind CSS (`^4.1.11`) - 用于快速构建界面样式。

---

## 3. 新增功能的技术选型

### 3.1. PDF 处理与渲染

*   **需求**: 在浏览器中将上传的 PDF 文件的每一页转换为图片。
*   **选型**: **`pdf.js-dist`**
*   **备选方案**: 无。`pdf.js` 是浏览器端 PDF 渲染无可争议的事实标准。
*   **决策理由**:
    *   **权威性**: 由 Mozilla 官方开发和维护，拥有最好的浏览器兼容性和最活跃的社区支持。
    *   **性能**: 经过多年发展，其在浏览器中的解析和渲染性能已经高度优化。
    *   **静态资源**: 该库需要依赖一个 `worker.js` 文件来在后台处理解析任务。我们需要在 Astro 项目中配置，确保这个 worker 文件能被正确地复制到最终的构建产物目录中，并能被主程序正确引用。
*   **实施要点**:
    *   安装 `pdf.js-dist` 包。
    *   配置 Astro (`astro.config.mjs` 或通过 `public` 目录) 来处理 `pdf.worker.min.js` 的静态文件托管。

### 3.2. 文件打包 (ZIP)

*   **需求**: 在浏览器中将所有分割后的图片打包成一个 `.zip` 文件供用户一键下载。
*   **选型**: **`jszip`**
*   **备选方案**: 无。`JSZip` 是前端 ZIP 处理领域最成熟、使用最广泛的库。
*   **决策理由**:
    *   **纯 JS 实现**: 无任何外部依赖，非常适合纯前端项目。
    *   **API 友好**: API 设计直观，可以方便地添加文件、生成 ZIP 数据。
    *   **内存考量**: 需要注意的是，在浏览器中生成大的 ZIP 文件会消耗可观的内存。对于用户一次性处理超大文件（例如有数百页的 PDF）的极端情况，需要进行测试，并可能需要在 UI 上给出提示。

### 3.3. 大文件处理与 UI 响应

*   **需求**: 处理 20MB 大文件时，避免浏览器界面卡死或无响应。
*   **选型**: **Web Worker**
*   **决策理由**:
    *   **避免阻塞**: JavaScript 是单线程的。直接在主线程中处理一个 20MB 的文件（无论是图片分割还是 PDF 渲染）都将导致 UI 完全冻结，给用户带来极差的体验。
    *   **后台处理**: Web Worker 允许我们将这些计算密集型任务完全转移到一个独立的后台线程中去执行。主线程仅负责与 Worker 通信（发送文件、接收结果）和更新 UI，从而保持页面的流畅和响应。
    *   **集成**: 我们的核心处理逻辑（使用 `pdf.js` 渲染或图片分割算法）都将被封装在一个 Worker 脚本中。
*   **实施要点**:
    *   需要创建一个独立的 Worker JS 文件 (e.g., `src/processing.worker.js`)。
    *   主页面脚本将创建此 Worker 的实例，并通过 `postMessage` 和 `onmessage` 事件与它通信。
    *   Astro 对于如何引入和构建 Worker 脚本有良好的支持。

---

## 4. 总结

| 功能需求         | 计划引入的依赖/技术 | 核心优势                                               |
| :--------------- | :------------------ | :----------------------------------------------------- |
| **PDF 渲染**     | `pdf.js-dist`       | 浏览器端事实标准，兼容性好                             |
| **文件打包**     | `jszip`             | 成熟可靠的纯 JS 实现                                   |
| **UI 性能保障**  | Web Worker          | 将密集计算移至后台，保证主线程 UI 流畅                 |

这份新的技术选型完全基于客户端技术，与 GitHub Pages 静态部署方式完全兼容，并主动考虑了处理大文件可能带来的性能问题，提出了健壮的解决方案。 

# 产品需求文档 (PRD) - v2 (纯客户端方案)

## 1. 背景与目标

随着用户基数的增长和使用场景的多样化，现有的长截图分割工具在处理大文件和支持文件类型方面遇到了瓶颈。为了提升用户体验、扩大应用范围并保持产品的竞争力，我们计划进行一次功能升级。

本次升级的核心目标是：

*   **提升处理能力**: 解决大尺寸图片无法处理的问题，满足专业用户和重度用户的需求。
*   **扩展文件格式**: 支持 PDF 文件，切入文档处理这一新的应用场景。
*   **优化操作流程**: 增加预览功能，允许用户在下载前确认分割结果，减少误操作和不必要的重复工作。

---

## 2. 用户故事 (User Stories)

| 角色           | 我想要...                                 | 以便我能...                               | 优先级 (MoSCoW) |
| :------------- | :---------------------------------------- | :---------------------------------------- | :-------------- |
| **重度用户**   | 上传并处理最大 20MB 的长截图图片。        | 无需预先压缩图片，顺畅地完成分割任务。    | **Must**        |
| **办公室职员** | 上传并分割多页 PDF 文档。                 | 快速地将 PDF 的每一页转换成独立的图片。 | **Must**        |
| **所有用户**   | 在执行分割后、下载文件前，预览所有结果。  | 检查分割是否准确，避免下载错误的文件。    | **Must**        |

---

## 3. 功能详述

### 3.1. 文件上传上限提升

*   **功能描述**: 前端应用将接受并处理最大 20MB 的文件。
*   **技术考量**:
    *   **前端**: 修改文件上传组件的 `accept` 和验证逻辑，允许 `application/pdf` 类型，并将文件大小的客户端验证逻辑上限调整为 20MB。
    *   **处理方式**: 所有处理将在浏览器内部通过 JavaScript 完成。
*   **性能影响**:
    *   在主线程中加载一个 20MB 的文件到内存中可能会导致短暂的 UI 卡顿。
    *   核心处理（图片分割、PDF 渲染）必须在 **Web Worker** 中进行，以防长时间阻塞主线程，并需要提供清晰的进度反馈（如进度条）。
*   **潜在问题**:
    *   **浏览器内存限制**: 移动设备或低配置电脑的浏览器在处理 20MB 文件时可能达到内存上限，导致页面崩溃。需要进行充分测试，并考虑对过大的文件进行友好提示。
    *   **UI 响应**: 必须通过 Web Worker 保证 UI 在处理期间的响应能力。

### 3.2. PDF 文件分割支持

*   **功能描述**: 用户可以上传 PDF 文件。系统在浏览器中将 PDF 的每一页渲染成一张独立的图片，以供后续操作。
*   **技术考量**:
    *   **核心依赖**: 使用 Mozilla 的 **`pdf.js-dist`** 库在客户端解析和渲染 PDF。
    *   **执行环境**: PDF 的解析和渲染过程将在 **Web Worker** 中执行，以避免阻塞主线程。Worker 将渲染出的每一页图片数据返回给主线程。
    *   **输出格式**: 默认将 PDF 页面转换为高质量的 PNG 或 JPEG 图片。
*   **潜在问题**:
    *   **字体和渲染**: PDF 中的非标准字体或复杂矢量图形在 `pdf.js` 中可能无法完美渲染。需要对多种 PDF 文件进行测试。
    *   **加密/密码保护**: `pdf.js` 支持处理有密码的 PDF，但需要用户输入密码。当前版本可设定为“不支持加密的 PDF”，并向用户显示明确提示。
    *   **性能**: 在浏览器中解析和渲染大型（例如超过 100 页）或图形复杂的 PDF 会非常耗时且消耗大量内存。需要设定一个合理的页数上限（例如 200 页），并进行性能基准测试。

### 3.3. 分割结果预览界面

*   **功能描述**: 文件在浏览器中处理完毕后，系统在当前页面动态生成一个预览区域，展示所有结果。
*   **界面设计**:
    *   预览区域以网格形式展示所有分割后的图片。这些图片使用 `Blob URL` 或 `Data URL` 在本地生成，不涉及服务器交互。
    *   每张预览图下方有独立的下载按钮。
    *   提供一个 "全部下载" 的按钮，将所有结果在浏览器端打包成一个 `.zip` 文件下载。
    *   预览图应支持点击放大查看（灯箱效果）。
*   **技术考量**:
    *   **状态管理**: 前端需要一个状态管理器（或简单的原生 JS 对象）来持有所有生成的图片数据（`Blob` 对象）。
    *   **打包下载**: "全部下载" 功能将使用 **`jszip`** 库在浏览器端实现。它会读取所有 `Blob` 数据并生成一个可供下载的 ZIP 文件。
*   **潜在问题**:
    *   如果分割结果数量非常多（例如一个有 200 页的 PDF），生成大量的 `Blob URL` 并渲染 DOM 可能会消耗大量内存，导致页面变慢。需要考虑对预览进行**虚拟化或分页加载**的优化策略。
    *   使用 `jszip` 打包大量或大尺寸图片时，可能会耗尽浏览器内存。需要测试其性能边界。

---

## 4. 非功能性需求

| 类别       | 需求描述                                                                                                                             |
| :--------- | :----------------------------------------------------------------------------------------------------------------------------------- |
| **性能**   | *  在标准桌面浏览量器中，处理 20MB 文件的平均时间应控制在 30 秒以内。<br> * 预览区域的渲染时间应在 3 秒以内（首屏）。<br> * 文件处理期间，UI不得出现超过 1 秒的冻结。 |
| **可用性** | *  上传、处理、预览、下载的整个流程应该直观易懂，无需额外说明。<br> * 对不支持的文件类型或超出大小/页数限制的文件，应提供清晰、即时的错误提示。 |
| **可靠性** | *  在 99% 的情况下，PDF 页面渲染结果应与源文件视觉一致。<br> * 浏览器处理失败时（如内存不足），应能优雅地捕获错误并向用户返回友好的提示信息。 |

---

## 5. 验收标准

**我们认为此项目完成，当且仅当以下所有条件都得到满足：**

1.  **文件上传**:
    *   ✅ 用户可以成功上传小于等于 20MB 的 JPG, PNG, GIF, WebP 文件。
    *   ✅ 用户可以成功上传小于等于 20MB 的 PDF 文件。
    *   ✅ 尝试上传大于 20MB 的文件时，前端会立即显示明确的错误信息。
    *   ✅ 尝试上传不受支持的文件类型（如 `.txt`, `.mp4`）时，前端会立即显示明确的错误信息。

2.  **文件处理**:
    *   ✅ 上传的图片文件能被正确分割，逻辑与现有功能保持一致，且在 Web Worker 中执行。
    *   ✅ 上传的 PDF 文件的每一页都被 `pdf.js` 在 Web Worker 中成功转换成一张独立的 PNG 图片。
    *   ✅ 应用能够处理包含至少 50 页的标准 PDF 文件而不会导致浏览器标签页崩溃。

3.  **结果预览**:
    *   ✅ 分割/转换完成后，用户被自动导航至预览页面。
    *   ✅ 预览页面以网格布局展示所有结果图片。
    *   ✅ 用户可以点击单张图片进行放大预览。
    *   ✅ 用户可以点击每张图片下方的按钮，单独下载该图片。
    *   ✅ 用户可以点击“全部下载”按钮，通过 `jszip` 在浏览器端生成并下载一个包含所有结果图片的 ZIP 文件。
    *   ✅ ZIP 文件的命名应有意义（例如，`original-filename-split.zip`）。

4.  **错误处理**:
    *   ✅ 如果浏览器在处理文件时发生任何错误（例如，PDF 格式损坏、内存不足），前端会向用户显示一个友好的错误提示，而不是崩溃或无响应。 
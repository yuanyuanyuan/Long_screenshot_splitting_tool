# 移除单文件构建模式并实现可配置资源地址 - 任务列表

## 1. 移除单文件模式相关代码

### 1.1 移除单文件模式构建脚本
- [ ] 修改 `packages/screenshot-splitter/package.json`，移除 `build:single` 脚本
- [ ] 移除 `preview:single` 和相关的单文件预览脚本
- 引用需求：1.1, 1.2, 1.3

### 1.2 清理Vite配置中的单文件模式代码
- [ ] 修改 `vite.config.base.js`，移除 `vite-plugin-singlefile` 导入
- [ ] 移除 `createSingleFileConfig` 函数
- [ ] 移除单文件模式相关的插件配置
- [ ] 移除单文件模式特定的构建配置
- 引用需求：1.2, 1.3

### 1.3 更新构建管理器
- [ ] 修改 `tools/build-scripts/build-manager.js`，移除单文件模式构建逻辑
- [ ] 更新 `buildComponent` 函数，只支持SPA模式
- [ ] 移除单文件模式相关的目录清理逻辑
- 引用需求：1.1, 1.2, 1.3

## 2. 实现可配置资源地址功能

### 2.1 增强环境配置系统
- [ ] 修改 `tools/build-scripts/env-config.js`，添加 `getAssetsBaseUrl()` 函数
- [ ] 更新 `getBuildConfig()` 函数，包含 `assetsBaseUrl` 属性
- [ ] 添加资源URL验证逻辑
- 引用需求：2.1, 2.2, 2.3, 4.1, 4.2

### 2.2 集成Vite配置
- [ ] 修改 `vite.config.base.js`，使用配置的资源地址
- [ ] 更新 `createBaseConfig` 函数，接收 `assetsBaseUrl` 参数
- [ ] 确保Vite的 `base` 配置正确设置
- 引用需求：2.1, 2.2, 2.3, 5.1, 5.2

### 2.3 更新构建脚本集成
- [ ] 修改构建脚本以使用新的资源配置
- [ ] 确保环境变量正确传递到构建流程
- 引用需求：2.3, 4.2, 4.3

## 3. 清理和优化

### 3.1 移除单文件模式依赖
- [ ] 从根目录 `package.json` 移除 `vite-plugin-singlefile` 依赖
- [ ] 清理不再需要的构建脚本和工具
- 引用需求：1.2, 1.3

### 3.2 优化构建输出目录
- [ ] 移除单文件模式特定的输出目录配置
- [ ] 清理 `dist-single` 目录相关逻辑
- 引用需求：1.3, 6.1

## 4. 测试验证

### 4.1 编写单元测试
- [ ] 为 `getAssetsBaseUrl()` 函数编写测试用例
- [ ] 测试默认相对路径行为
- [ ] 测试自定义资源地址配置
- [ ] 测试无效URL验证
- 引用需求：2.1, 2.2, 2.3, 7.1, 7.2, 7.3

### 4.2 集成测试
- [ ] 测试构建流程的正确性
- [ ] 验证构建产物资源引用正确性
- [ ] 测试不同环境配置下的行为
- 引用需求：2.3, 6.1, 7.1, 7.2

### 4.3 向后兼容性测试
- [ ] 验证现有SPA模式功能不受影响
- [ ] 测试GitHub Pages部署继续正常工作
- [ ] 确保默认配置行为与之前一致
- 引用需求：6.1, 6.2, 6.3

## 5. 文档更新

### 5.1 更新README构建说明
- [ ] 移除单文件模式相关说明
- [ ] 更新构建命令文档
- [ ] 添加资源地址配置说明
- 引用需求：3.1, 3.2, 3.3

### 5.2 更新配置文档
- [ ] 添加 `ASSETS_BASE_URL` 环境变量说明
- [ ] 提供配置示例和使用场景
- 引用需求：3.2, 3.4

### 5.3 更新部署指南
- [ ] 移除单文件模式部署说明
- [ ] 添加CDN部署配置示例
- 引用需求：3.4, 7.2, 7.3

## 6. 代码质量保证

### 6.1 代码审查和清理
- [ ] 确保所有单文件模式代码完全移除
- [ ] 验证没有残留的单文件模式逻辑
- [ ] 检查代码风格一致性
- 引用需求：1.3, 6.1

### 6.2 构建性能监控
- [ ] 监控构建时间变化
- [ ] 验证构建产物大小
- 引用需求：6.1

## 执行顺序说明

1. 首先执行任务1.x（移除单文件模式代码）
2. 然后执行任务2.x（实现资源配置功能）  
3. 接着执行任务3.x（清理优化）
4. 并行执行任务4.x（测试验证）
5. 最后执行任务5.x（文档更新）

每个任务都应包含相应的测试验证，确保代码质量。
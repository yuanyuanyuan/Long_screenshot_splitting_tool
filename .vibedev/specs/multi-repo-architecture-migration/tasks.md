# 多仓库架构改造任务列表

## 概述
本任务列表详细描述了将monorepo改造为多仓库架构的具体实施步骤。所有任务都基于需求文档和设计文档，采用测试驱动的方式逐步实施。

## 阶段一：基础设施准备

### 1. 创建备份和回滚机制
- [ ] 创建当前项目结构的完整备份
- [ ] 编写回滚脚本，支持快速恢复monorepo结构
- [ ] 建立迁移日志记录机制
- **需求参考**: 非功能需求-部署要求

### 2. 设置测试环境
- [ ] 配置独立的测试环境验证改造效果
- [ ] 确保所有现有测试都能正常运行
- [ ] 创建架构改造专用的测试套件
- **需求参考**: 测试策略要求

## 阶段二：项目结构改造

### 3. 移除pnpm workspace配置
- [ ] 删除根目录的`pnpm-workspace.yaml`文件
- [ ] 重构根目录`package.json`，移除workspace相关配置
- [ ] 验证pnpm命令不再识别workspace
- **需求参考**: 1.1, 1.3

### 4. 重构package.json依赖
- [ ] 修改screenshot-splitter的package.json，移除`workspace:*`依赖
- [ ] 配置shared-components为可发布的npm包结构
- [ ] 使用`file:../shared-components`依赖方式
- **需求参考**: 2.1, 2.2, 2.3

### 5. 验证依赖解析
- [ ] 测试本地file依赖的正确解析
- [ ] 验证构建过程不依赖workspace
- [ ] 确保开发服务器能正常启动
- **需求参考**: 2.5, 5.2

## 阶段三：配置化改造

### 6. 创建config目录结构
- [ ] 在screenshot-splitter下创建config目录
- [ ] 按照设计文档创建子目录结构（app/, build/, env/, constants/）
- [ ] 迁移现有的配置代码到对应目录
- **需求参考**: 3.1, 3.2, 3.3

### 7. 应用配置提取
- [ ] 创建`config/app/app.config.ts`，定义AppConfig接口
- [ ] 迁移应用相关配置（名称、版本、环境等）
- [ ] 更新代码引用路径，使用新的配置位置
- **需求参考**: 3.4, 3.5

### 8. 构建配置提取
- [ ] 创建`config/build/vite.config.ts`，定义BuildConfig接口
- [ ] 迁移Vite构建配置到新位置
- [ ] 确保TypeScript配置兼容新结构
- **需求参考**: 3.4, 4.1, 4.2

### 9. 环境配置管理
- [ ] 创建环境配置文件（development.ts, production.ts, test.ts）
- [ ] 实现环境变量加载和验证逻辑
- [ ] 确保各环境配置正确加载
- **需求参考**: 3.4, 5.3

## 阶段四：错误处理和测试

### 10. 实现依赖解析错误处理
- [ ] 创建`DependencyResolver`类，实现fallback机制
- [ ] 添加详细的错误日志和用户提示
- [ ] 测试各种依赖解析失败场景
- **需求参考**: 错误处理设计

### 11. 构建错误处理
- [ ] 创建`BuildErrorHandler`类，检测workspace相关错误
- [ ] 实现友好的错误提示和解决方案建议
- [ ] 验证构建过程中的错误处理
- **需求参考**: 错误处理设计

### 12. 单元测试覆盖
- [ ] 为所有新创建的配置类编写单元测试
- [ ] 测试依赖解析的各种边界情况
- [ ] 确保测试覆盖率达到要求
- **需求参考**: 8.1, 8.2

### 13. 集成测试验证
- [ ] 创建集成测试验证整体架构改造
- [ ] 测试应用启动和基本功能
- [ ] 验证配置加载的正确性
- **需求参考**: 8.1, 8.2

## 阶段五：功能回归和优化

### 14. 功能回归测试
- [ ] 运行所有现有测试，确保功能不受影响
- [ ] 测试上传->分割->导出的完整工作流
- [ ] 验证性能指标没有下降
- **需求参考**: 5.4, 5.5

### 15. 开发体验优化
- [ ] 验证热重载和调试功能正常工作
- [ ] 确保开发服务器启动速度不受影响
- [ ] 提供开发文档说明新架构
- **需求参考**: 5.1, 5.2, 5.3

### 16. 构建性能优化
- [ ] 分析构建性能，优化配置
- [ ] 确保构建时间没有显著增加
- [ ] 验证生产构建的包体积
- **需求参考**: 性能要求

## 阶段六：文档和交付

### 17. 更新项目文档
- [ ] 编写架构改造的详细文档
- [ ] 更新README说明新的项目结构
- [ ] 提供开发指南和故障排除
- **需求参考**: 5.3

### 18. 创建部署脚本
- [ ] 更新部署脚本适应新架构
- [ ] 确保部署流程简单可靠
- [ ] 验证生产环境部署
- **需求参考**: 4.5

### 19. 最终验证
- [ ] 运行完整的测试套件
- [ ] 验证所有成功标准达成
- [ ] 创建最终验收报告
- **需求参考**: 成功标准

## 任务依赖关系
1. 阶段一 → 阶段二 → 阶段三 → 阶段四 → 阶段五 → 阶段六
2. 备份机制(1)应在所有代码修改前完成
3. 测试环境(2)应尽早建立
4. 错误处理(10-11)应在主要改造完成后实施
5. 回归测试(14)应在所有功能改造完成后进行

## 风险缓解
- 每个阶段都有对应的测试验证
- 备份机制支持快速回滚
- 分阶段实施降低风险
- 详细的日志记录便于问题排查